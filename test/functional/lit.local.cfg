# -*- coding: utf-8 -*-

import os
import os.path
import lit.util

# test_source_root: The root path where tests are located.
this_dir = os.path.dirname(__file__)
tool_dir = os.path.join(this_dir, 'tools')

config.environment['test_input_dir'] = os.path.join(this_dir, 'Input')

config.environment['CC'] = 'cc'
config.environment['CXX'] = 'c++'
config.environment['LC_CTYPE'] = 'en_US.UTF-8'

if 'BEAR_EXE' in lit_config.params and 'EXEC_LIB' in lit_config.params:
    bear_call = '{bear} --interceptor {interceptor} --executor {executor} --libexec {libear} -vvvv'.format(
        bear=lit_config.params['BEAR_EXE'],
        interceptor=lit_config.params['INTERCEPT_EXE'],
        executor=lit_config.params['ER_EXE'],
        libear=lit_config.params['EXEC_LIB'])
else:
    bear_call = 'bear -vvvv'
config.substitutions.append(
    ('%{intercept-build}', bear_call))

config.substitutions.append(
    ('%{cdb_diff}',
    '{python} {cdb_diff}'.format(python=sys.executable,
                                 cdb_diff=os.path.join(tool_dir, 'cdb_diff.py'))))

config.substitutions.append(
    ('%{cmake}',
     'cmake' if lit_config.params.get('MULTILIB') is None else 'cmake -DCMAKE_C_COMPILER_ARG1="-m32"'))

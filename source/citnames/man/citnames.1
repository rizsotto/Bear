.\" Automatically generated by Pandoc 2.19.2
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "CITNAMES" "1" "Jan 02, 2023" "Bear User Manuals" ""
.hy
.SH NAME
.PP
citnames - deduce command semantic
.SH SYNOPSIS
.PP
citnames [\f[I]options\f[R]] --input <file> --output <file>
.SH DESCRIPTION
.PP
The name citnames comes from to reverse the word \[lq]semantic\[rq].
.PP
Because when you type a command, you know your intent.
The command execution is just a thing to achieve your goal.
This program takes the command which was executed, and try to find out
what the intent was to run that command.
It deduces the semantic of the command.
.PP
This is useful to generate a compilation database.
Citnames get a list of commands, and it creates a JSON compilation
database.
(This is currently the only output of the tool.)
.SH OPTIONS
.TP
--version
Print version number.
.TP
--help
Print help message.
.TP
--verbose
Enable verbose logging.
.TP
--input \f[I]file\f[R]
Specify input file.
(Default file name provided.)
The input is a command execution list, with some extra information.
The syntax is detailed in a separate section.
.TP
--output \f[I]file\f[R]
Specify output file.
(Default file name provided.)
The output is currently a JSON compilation database.
.TP
--append
Use previously generated output file and append the new entries to it.
This way you can run continuously during work, and it keeps the
compilation database up to date.
File deletion and addition are both considered.
But build process change (compiler flags change) might cause duplicate
entries.
.TP
--update
Update the previously generated output with the new entries and flags.
This flag works similarly to the append flag but it also rewrites old
entries if the flags used to compile the file change, allowing for build
process changes.
.TP
--run-checks
Allow the program to verify file location checks on the current machine
it runs.
(Default value provided.
Run help to query it.)
This is important if the execution list is not from the current host.
.TP
--config \f[I]file\f[R]
Specify a configuration file.
The configuration file captures how the output should be formatted and
which entries it shall contain.
.SH EXIT STATUS
.PP
Citnames exit status is non-zero in case of IO problems, otherwise
it\[cq]s zero.
The exit status is independent of how many command it recognized or was
it recognized at all.
.SH OBSERVABILITY
.PP
Any insight about the command recognition logic can be observed with
\f[V]--verbose\f[R] flag on the standard error.
Otherwise, the command is silent.
.SH INPUT FILE
.PP
It\[cq]s a JSON file, with the command execution history.
(Plus some metadata, that is useful for debugging the application which
was produced it.)
This file can be produced by the \f[V]intercept\f[R] command, which
records the process executions of a build.
.PP
Read more about the syntax of the file in the \f[V]intercept\f[R] man
page.
.SH OUTPUT FILE
.PP
Currently, the only output format is the JSON compilation database.
Read more about the syntax of that in the \f[V]bear\f[R] man page.
.SH CONFIG FILE
.PP
The config file influences the command recognition (by the section
\[lq]compilation\[rq]) and the output format (by the section
\[lq]output\[rq]).
.PP
The config file is optional.
The program will use default values, which can be dumped with the
\f[V]--verbose\f[R] flags.
.PP
Some parts of the file has overlap with the command line arguments.
If both present the command line argument overrides the config file
values.
.IP
.nf
\f[C]
{
  \[dq]compilation\[dq]: {
    \[dq]compilers_to_recognize\[dq]: [
      {
        \[dq]executable\[dq]: \[dq]/usr/bin/mpicc\[dq],
        \[dq]flags_to_add\[dq]: [\[dq]-I/opt/MPI/include\[dq]],
        \[dq]flags_to_remove\[dq]: [\[dq]-Wall\[dq]]
      }
    ],
    \[dq]compilers_to_exclude\[dq]: []
  },
  \[dq]output\[dq]: {
    \[dq]content\[dq]: {
      \[dq]include_only_existing_source\[dq]: true,
      \[dq]paths_to_include\[dq]: [],
      \[dq]paths_to_exclude\[dq]: []
    },
    \[dq]format\[dq]: {
      \[dq]command_as_array\[dq]: true,
      \[dq]drop_output_field\[dq]: false
    }
  }
}
\f[R]
.fi
.TP
\f[V]compilation.compilers_to_recognize\f[R]
where compiler can be specified, which are not yet recognized by
default.
The \f[V]executable\f[R] is an absolute path to the compiler.
The \f[V]flags_to_add\f[R] is an optional attribute, which contains
flags which will append to the final output.
(It\[cq]s a good candidate to use this for adding OpenMPI compiler
wrapper flags from the \f[V]mpicc --showme:compile\f[R] output.)
The \f[V]flags_to_remove\f[R] is an optional attribute, where the given
flags will be removed for the final argument list.
(The flags checked for equality only, no regex match.
Flags with arguments are not good candidates to put here, because the
removal logic is too simple for that.)
.TP
\f[V]compilation.compilers_to_exclude\f[R]
this is an optional list of executables (with absolute path) which needs
to be removed from the output.
.TP
\f[V]output.content\f[R]
The \f[V]paths_to_include\f[R] and \f[V]paths_to_exclude\f[R] are for
filter out entries from these directories.
(Directory names can be absolute paths or relative to the current
working directory if the \f[V]--run-checks\f[R] flag passed.)
The \f[V]include_only_existing_source\f[R] allows or disables file check
for the output.
The \f[V]--run-checks\f[R] flag overrides this config value.
.TP
\f[V]output.format\f[R]
The \f[V]command_as_array\f[R] controls which command field is emitted
in the output.
True produces \f[V]arguments\f[R], false produces \f[V]command\f[R]
field.
The \f[V]drop_output_field\f[R] will disable the \f[V]output\f[R] field
from the output.
.SH SEE ALSO
.PP
bear(1), intercept(1)
.SH COPYRIGHT
.PP
Copyright (C) 2012-2022 by L\['a]szl\['o] Nagy
<https://github.com/rizsotto/Bear>
.SH AUTHORS
L\['a]szl\['o] Nagy.
